<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 

<%= form_for request.path, :method => 'get' do |f|%>
    <%= f.label :search_text %>
    <select id="month" name="month">
    	<% ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December' ].each_with_index.map do |month, i|%>
    		<option <% if @month == i+1 %> selected="selected" <% end %> value="<%=i+1%>"><%=month%></option>
    	<% end %>
		</select>
		<select id="day" name="day">
			<% Time.now.end_of_month.day.times do |i| %>
				<option <% if @day == i+1 %> selected="selected" <% end %>  value="<%=i+1%>"><%=i+1%></option>
			<% end %>
		</select>

    <%= f.submit 'Search trips'%>
<% end %>

<div id="map_canvas" style="width: 550px; height: 450px"></div> 


<script type="text/javascript"> 
//<![CDATA[
	$(document).ready(function () {
     // global "map" variable
      var map = null;
      var marker = null;
      var initialLat = <%= @booked_pins.last.latitude %>;
      var initialLng = <%= @booked_pins.last.longitude %>;


			var infowindow = new google.maps.InfoWindow(
			  { 
			    size: new google.maps.Size(150,50)
			  });

			function createMarker(latlng, name, html, color) {
			    var contentString = html;
			    var marker = new google.maps.Marker({
			        position: latlng,
			        map: map,
			        icon:'/assets/'+color+'_pin.png'
			        //zIndex: Math.round(latlng.lat()*-100000)<<5
			     });

			    google.maps.event.addListener(marker, 'click', function() {
			        infowindow.setContent(contentString); 
			        infowindow.open(map,marker);
			        });
			    google.maps.event.trigger(marker, 'click');    
			    return marker;
			}

		 

			function initialize() {
			  // create the map
			  var myOptions = {
			    zoom: 6,
			    center: new google.maps.LatLng(initialLat, initialLng),
			    mapTypeControl: true,
			    mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
			    navigationControl: true,
			    mapTypeId: google.maps.MapTypeId.ROADMAP
			  }

			  map = new google.maps.Map(document.getElementById("map_canvas"),
			                                myOptions);

			  var latlng; 
			  var html;
			  <% @booked_pins.each do |p| %>
			  	latlng = new google.maps.LatLng(<%= p.latitude %>, <%= p.longitude %>); 
			  	html = '<%= link_to p.title, guide_post_url(p) %><br/>'+
			  					'Date: <%= p.date%>'
			  	marker = createMarker(latlng, "name", html, "red");
			  <% end %>

			  <% @pending_pins.each do |p| %>
			  	latlng = new google.maps.LatLng(<%= p.latitude %>, <%= p.longitude %>); 
			  	html = '<%= link_to p.title, guide_post_url(p) %><br/>'+
			  					'Date: <%= p.date%>'
			  	marker = createMarker(latlng, "name", html, "yellow");
			  <% end %>
			  
			  

			}
			initialize();
		});
//]]>
</script> 